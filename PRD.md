# 英语口语学习滚动字幕应用 - 产品需求文档 (PRD)

## 产品概述

**产品名称**: 英语口语学习滚动字幕应用
**产品定位**: 通过国外博主Vlog视频，提供沉浸式英语口语学习体验
**目标用户**: 想要提高英语口语的成人学习者
**产品类型**: Web应用

## 产品路线图

### V1: 最小可行产品 (MVP)

**核心功能清单：**
- **视频播放器** - 支持常见视频格式播放
- **字幕同步高亮** - 实时根据视频播放进度高亮对应字幕行
- **字幕自动滚动** - 高亮字幕行始终保持在可视区域内，平滑滚动
- **点击定位功能** - 点击任意字幕行，视频跳转到对应时间点
- **中英字幕切换** - 支持纯英文和中英对照两种显示模式
- **点读模式** - 单句循环播放，播完当前句不自动切换
- **基础播放控制** - 播放/暂停、进度条、音量控制

### V2 及以后版本 (Future Releases)

**V2.0 增强学习功能：**
- **播放速度调节** - 0.5x-2.0x变速播放，适应不同学习节奏
- **词汇标记系统** - 点击单词查看释义，标记生词
- **学习进度跟踪** - 记录学习时长、完成进度
- **字幕搜索功能** - 全文搜索特定词汇或句子

**V2.1 内容管理：**
- **多视频管理** - 视频库、分类、收藏功能
- **离线下载** - 支持视频和字幕离线缓存
- **视频推荐** - 基于学习水平的智能推荐

**V3.0 互动学习：**
- **语音跟读功能** - 录音对比，发音纠正
- **学习统计分析** - 词汇掌握度、学习报告
- **社区功能** - 学习笔记分享、讨论区

## 关键业务逻辑 (Business Rules)

### 1. 字幕同步高亮逻辑
- 每个字幕条目包含开始时间(startTime)和结束时间(endTime)
- 视频播放时，实时检查当前播放时间，匹配对应的字幕条目
- 当前时间 >= startTime 且 < endTime 的字幕行设为高亮状态
- 支持字幕时间偏移调整，应对音视频不同步问题

### 2. 自动滚动算法
- 高亮字幕行需始终保持在字幕容器的可视区域内
- 当高亮行接近容器底部时，触发向上滚动
- 滚动采用平滑动画，避免突兀跳跃
- 滚动速度与视频播放速度联动

### 3. 点击定位规则
- 点击字幕行时，获取该行的startTime
- 视频跳转到startTime位置并开始播放
- 同步更新字幕高亮状态
- 自动滚动到对应位置

### 4. 点读模式逻辑
- 激活点读模式后，视频播放到当前句结束时暂停
- 不自动切换到下一句高亮
- 用户需手动点击下一句或关闭点读模式继续播放

## 数据契约 (Data Contract)

### 1. 视频数据格式
```
支持格式: MP4, WebM, OGV
编码要求: H.264/VP8/VP9 视频编码，AAC/MP3 音频编码
分辨率: 720P-4K，自适应播放
```

### 2. 字幕数据结构
```json
{
  "videoId": "unique_video_identifier",
  "language": "en",
  "subtitles": [
    {
      "id": 1,
      "startTime": 0.0,
      "endTime": 3.5,
      "text": "Hello everyone, welcome to my channel!",
      "translation": "大家好，欢迎来到我的频道！"
    }
  ]
}
```

### 3. 配置数据
```json
{
  "playbackSettings": {
    "autoScroll": true,
    "highlightDelay": 0,
    "scrollOffset": 100
  },
  "displaySettings": {
    "showTranslation": false,
    "readingMode": false,
    "fontSize": "medium"
  }
}
```

### 4. 时间轴精度要求
- 字幕时间精确到毫秒级 (0.001s)
- 支持SRT、VTT标准字幕格式导入
- 时间偏移范围：±5秒

## MVP 原型设计

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                        英语口语学习滚动字幕应用 MVP                           │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  ┌─────────────────────────────────┐  ┌───────────────────────────────────┐ │
│  │                                 │  │ 字幕控制区                        │ │
│  │                                 │  │ ┌─────┐ ┌─────┐ ┌─────┐ ┌─────┐ │ │
│  │                                 │  │ │中英文│ │点读模│ │同步高│ │自动滚│ │ │
│  │         视频播放区              │  │ │切换 │ │式  │ │亮  │ │动  │ │ │
│  │      (720P-4K自适应)            │  │ └─────┘ └─────┘ └─────┘ └─────┘ │ │
│  │                                 │  └───────────────────────────────────┘ │
│  │                                 │                                        │
│  │                                 │  ┌───────────────────────────────────┐ │
│  │                                 │  │ 字幕显示区 (可滚动)                │ │
│  │                                 │  │                                   │ │
│  │                                 │  │ [00:01] Hello everyone!           │ │
│  │                                 │  │         大家好！                   │ │
│  │                                 │  │                                   │ │
│  └─────────────────────────────────┘  │ 【00:04】Welcome to my channel!   │ │
│                                        │          欢迎来到我的频道！        │ │
│  ┌─────────────────────────────────┐  │                                   │ │
│  │ ▶️ ⏸️  ⏮️ ⏭️  🔊 ━━━●━━━ 2:45/10:30 │  │ [00:08] Today I'm going to...     │ │
│  │      播放控制栏                  │  │         今天我将要...               │ │
│  └─────────────────────────────────┘  │                                   │ │
│                                        │ [00:12] show you something...     │ │
│                                        │         向你展示一些...             │ │
│                                        │                                   │ │
│                                        │ ▼ 更多字幕内容...                   │ │
│                                        └───────────────────────────────────┘ │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘

功能说明:
• 点击字幕行 → 视频跳转到对应时间
• 高亮行(【】标记) → 当前播放位置对应字幕
• 字幕区自动滚动 → 保持高亮行在可视区域
• 中英文切换 → 显示/隐藏中文翻译
• 点读模式 → 播放完当前句后暂停
```

## 架构设计蓝图

### 核心流程图

#### 字幕同步流程图
```mermaid
sequenceDiagram
    participant V as VideoPlayer
    participant S as SubtitleManager
    participant UI as SubtitleDisplay
    participant SC as ScrollController

    V->>S: timeupdate event (currentTime)
    S->>S: findCurrentSubtitle(currentTime)
    S->>UI: highlightSubtitle(subtitleId)
    UI->>SC: checkScrollNeeded(highlightedElement)
    SC->>UI: smoothScrollTo(position)
    UI->>UI: updateHighlight()
```

#### 点击定位流程图
```mermaid
flowchart TD
    A[用户点击字幕行] --> B[获取字幕startTime]
    B --> C[视频跳转到startTime]
    C --> D[触发timeupdate事件]
    D --> E[更新字幕高亮]
    E --> F[自动滚动到对应位置]
```

### 组件交互说明

#### 核心模块结构
- **VideoPlayer.js** - 视频播放控制
- **SubtitleManager.js** - 字幕数据管理和同步逻辑
- **SubtitleDisplay.js** - 字幕UI渲染和交互
- **ScrollController.js** - 自动滚动算法
- **ModeController.js** - 点读模式、中英文切换控制

#### 模块依赖关系
```mermaid
graph LR
    A[App.js] --> B[VideoPlayer.js]
    A --> C[SubtitleDisplay.js]
    B --> D[SubtitleManager.js]
    C --> D
    C --> E[ScrollController.js]
    A --> F[ModeController.js]
    F --> C
    F --> B
```

### 技术选型与风险

#### 技术栈选择
- **前端框架**: React 18 + TypeScript
- **视频播放**: HTML5 Video API + Video.js (增强功能)
- **状态管理**: React Context + useReducer
- **样式方案**: CSS Modules + Tailwind CSS
- **构建工具**: Vite
- **字幕解析**: 自研SRT/VTT解析器

#### 潜在技术风险

🔴 **高风险**
- 视频格式兼容性问题 → 解决方案：转码服务预处理
- 字幕同步精度不足 → 解决方案：毫秒级时间戳，缓冲区优化

🟡 **中风险**
- 大字幕文件性能问题 → 解决方案：虚拟滚动，懒加载
- 移动端自动滚动卡顿 → 解决方案：使用transform3d，降低滚动频率

🟢 **低风险**
- 浏览器兼容性 → 现代浏览器支持良好
- 字幕格式解析 → 标准格式，成熟方案

## 最终确认

本PRD文档已完成MVP版本的完整规划，包含：
- ✅ 产品路线图 (V1 MVP + 未来版本规划)
- ✅ 核心功能清单和业务逻辑
- ✅ 数据契约和技术架构
- ✅ MVP原型设计图
- ✅ 技术选型和风险评估

**下一步行动**: 等待最终确认，准备进入开发阶段。

---
*文档创建时间: 2025-09-22*
*版本: v1.0*
*产品设计师: Claude*